<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>水印</title>
    <style>
      html,
      body {
        height: 100%;
      }
    </style>
  </head>
  <body>
    <script>
      function generateWaterMark(text) {
        const canvas = document.createElement('canvas')
        const ctx = canvas.getContext('2d')
        
        // canvas画布大小
        canvas.width = 200
        canvas.height = 80
        
        // 水印字样式
        ctx.font = '15px Vedana'
        ctx.fillStyle = '#999'
        
        // 水印旋转角度
        ctx.rotate(-30 * Math.PI / 180)
        ctx.fillText(text, 0, canvas.height)
        
        return canvas.toDataURL('image/png')
      }
      
      function setWatermark(targetNode, text){
        const styleStr = `background: url(${generateWaterMark(text)}) left top repeat;`
        targetNode.setAttribute('style', styleStr)
        
        // 观察器的配置（需要观察什么变动）
        const config = {
          attributes: true
        };
        
        // 当观察到变动时执行的回调函数
        const callback = function(mutationsList, observer) {
          mutationsList.forEach(mutation => {
            if (mutation.type === 'attributes' && targetNode.getAttribute('style') !== styleStr) {
              targetNode.setAttribute('style', styleStr)
            }
          })
        };
        
        // 创建一个观察器实例并传入回调函数
        const observer = new MutationObserver(callback);
        
        // 以上述配置开始观察目标节点
        observer.observe(targetNode, config);
      }

      setWatermark(document.body, 'sanmao3.github.io')
    </script>
  </body>
</html>
