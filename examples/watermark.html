<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>水印</title>
    <style>
      body {
        min-height: 100vh;
        padding: 0;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <script>
      let setWatermark = (str) => {
        let canvas = document.createElement('canvas')
        // 设置canvas画布大小
        canvas.width = 150
        canvas.height = 80

        let ctx = canvas.getContext('2d')
        ctx.rotate(-30 * Math.PI / 180) // 水印旋转角度
        ctx.font = '15px Vedana'
        ctx.fillStyle = '#666666'
        ctx.textAlign = 'center'
        ctx.textBaseline = 'Middle'
        ctx.fillText(str, canvas.width / 2, canvas.height) // 水印在画布的位置x，y轴

        let styleStr = `background: url(${canvas.toDataURL('image/png')}) left top repeat;`
        document.body.setAttribute('style', styleStr)

        // 选择需要观察变动的节点
        const targetNode = document.body;

        // 观察器的配置（需要观察什么变动）
        const config = {
          attributes: true
        };

        // 当观察到变动时执行的回调函数
        const callback = function(mutationsList, observer) {
          mutationsList.forEach(mutation => {
            if (mutation.type === 'attributes' && targetNode.getAttribute('style') !== styleStr) {
              console.log('The ' + mutation.attributeName + ' attribute was modified.');
              targetNode.setAttribute('style', styleStr)
            }
          })
        };

        // 创建一个观察器实例并传入回调函数
        const observer = new MutationObserver(callback);

        // 以上述配置开始观察目标节点
        observer.observe(targetNode, config);
      }

      setWatermark('我是警察 0101')
    </script>
  </body>
</html>
